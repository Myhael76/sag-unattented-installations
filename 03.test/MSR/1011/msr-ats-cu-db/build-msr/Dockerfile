ARG SRC_IMAGE=centos:7
FROM centos:7

ARG SUIF_TEST_GPG_KEYS_FILE_1=/etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
ARG SUIF_INSTALL_INSTALL_DIR_MSR=/app/sag/1011/MSRAdapters
ARG SUIF_AUDIT_BASE_DIR=/app/audit
ARG SUIF_INSTALL_INSTALLER_BIN=/mnt/installer.bin
ARG SUIF_INSTALL_IMAGE_FILE_MSR=/mnt/products.zip
ARG SUIF_LOCAL_SCRIPTS_HOME=/mnt/scripts/local
ARG SUIF_SAG_USER_NAME=sag
ARG SUIF_HOME=/mnt/SUIF
ARG SUIF_SUM_HOME=/app/sum11
ARG SUIF_INSTALL_INSTALL_DIR_DBC=/app/sag/1011/DBC

ENV \
    SUIF_HOME=${SUIF_HOME} \
	SUIF_SUM_HOME=${SUIF_SUM_HOME} \
    SUIF_TEST_GPG_KEYS_FILE_1=${SUIF_TEST_GPG_KEYS_FILE_1} \ 
    JAVA_HOME=${SUIF_INSTALL_INSTALL_DIR_MSR}/jvm/jvm/ \
    JRE_HOME=${SUIF_INSTALL_INSTALL_DIR_MSR}/jvm/jvm/jre/ \
    SUIF_USER_HOME=/home/${SUIF_SAG_USER_NAME} \
    SUIF_LOCAL_SCRIPTS_HOME=${SUIF_LOCAL_SCRIPTS_HOME} \
    SUIF_AUDIT_BASE_DIR=${SUIF_AUDIT_BASE_DIR} \
    SUIF_SAG_USER_NAME=${SUIF_SAG_USER_NAME} \
    SUIF_SAG_GROUP_NAME=${SUIF_SAG_USER_NAME}group\
    SUIF_INSTALL_INSTALL_DIR_MSR=${SUIF_INSTALL_INSTALL_DIR_MSR}\
    SUIF_INSTALL_INSTALL_DIR_DBC=${SUIF_INSTALL_INSTALL_DIR_DBC} 

RUN if [ -f "$SUIF_TEST_GPG_KEYS_FILE_1" ] ; then rpmkeys --import "${SUIF_TEST_GPG_KEYS_FILE_1}" ; fi ;\ 
    yum -y update ;\ 
    yum -y install which less gettext telnet nc curl;\ 
    yum clean all ;\ 
    rm -rf /var/cache/yum ;\ 
	  groupadd -g 1804 ${SUIF_SAG_GROUP_NAME} ;\
	  useradd -u 1804 -m -g ${SUIF_SAG_GROUP_NAME} ${SUIF_SAG_USER_NAME} ;\ 
    mkdir -p \
        "${SUIF_AUDIT_BASE_DIR}" \  
        "${SUIF_HOME}" \
        "${SUIF_INSTALL_INSTALL_DIR_MSR}" \
        "${SUIF_LOCAL_SCRIPTS_HOME}" \
        "${SUIF_SUM_HOME}"  \
        "${SUIF_INSTALL_INSTALL_DIR_DBC}" \
        ;\ 
    touch "${SUIF_INSTALL_IMAGE_FILE_MSR}" "${SUIF_INSTALL_IMAGE_FILE_DBC}" "${SUIF_INSTALL_INSTALLER_BIN}" ;\ 

    chown ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_INSTALL_IMAGE_FILE_MSR}" "${SUIF_INSTALL_INSTALLER_BIN}" ;\ 
	chown -R ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_AUDIT_BASE_DIR}" ;\
    chown -R ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_HOME}" ;\
    chown -R ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_INSTALL_INSTALL_DIR_MSR}" ;\
    chown -R ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_LOCAL_SCRIPTS_HOME}" ;\
    chown -R ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_SUM_HOME}" ;\
    chown -R ${SUIF_SAG_USER_NAME}:${SUIF_SAG_GROUP_NAME} "${SUIF_INSTALL_INSTALL_DIR_DBC}" 


USER ${SUIF_SAG_USER_NAME}

 

VOLUME \
    "${SUIF_AUDIT_BASE_DIR}"\
    "${SUIF_HOME}" \
    "${SUIF_INSTALL_INSTALL_DIR_MSR}" \
    "${SUIF_INSTALL_INSTALL_DIR_DBC}" \
    "${SUIF_LOCAL_SCRIPTS_HOME}" \
    "${SUIF_SUM_HOME}"
